# üß≠ –°—É—á–∞—Å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ opi-zero-stack

> –û–Ω–æ–≤–ª–µ–Ω–∏–π –¥–∏–∑–∞–π–Ω –±–µ–∑ Orange Pi PC: –ü–ö –≤–∏–∫–æ–Ω—É—î —Ä–æ–ª—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ –∑ LLM —Ç–∞ –æ–±—Ä–æ–±–∫–æ—é –≤—ñ–¥–µ–æ, Orange Pi Zero ‚Äî –≤–∏–∫–æ–Ω–∞–≤–µ—Ü—å —ñ–∑ FastAPI/MQTT, Arduino Mega + PCA9685 ‚Äî –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π —à–∞—Ä –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∞–º–∏ —Ç–∞ —Ä–µ–ª–µ.

## üîé –û–≥–ª—è–¥
- **–ü–ö (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)**: FastAPI —Å–µ—Ä–≤—ñ—Å –∑ LLM (Ollama), RAG –¥–ª—è –∑–Ω–∞–Ω—å –ø—Ä–æ –≤–∏—Ä–æ—â—É–≤–∞–Ω–Ω—è, –∞–Ω–∞–ª—ñ–∑ –≤—ñ–¥–µ–æ –∑ –ø–æ—Ç–æ–∫—É –∫–∞–º–µ—Ä–∏ Orange Pi Zero, –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å —ñ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ REST/MQTT.
- **Orange Pi Zero (–≤–∏–∫–æ–Ω–∞–≤–µ—Ü—å)**: FastAPI + MQTT, –ª–æ–∫–∞–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è, HTTP-–∫–ª—ñ—î–Ω—Ç –¥–æ –ü–ö, GPIO –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ä–µ–ª–µ, –≤–∑–∞—î–º–æ–¥—ñ—è –∑ Arduino —á–µ—Ä–µ–∑ Serial, –±–∞–∑–æ–≤–∏–π –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–∞–¥–∞—á.
- **Arduino Mega + PCA9685**: —Ä—É—Ö 6 DOF —Ä–æ–±–æ—Ä—É–∫–∏, –∞–Ω–∞–ª–æ–≥–æ–≤—ñ –¥–∞—Ç—á–∏–∫–∏ (–≤–æ–ª–æ–≥—ñ—Å—Ç—å “ë—Ä—É–Ω—Ç—É, –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è), –∞–≤–∞—Ä—ñ–π–Ω–∞ –∑—É–ø–∏–Ω–∫–∞ —Ç–∞ watchdog, JSON –ø—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–º–∞–Ω–¥.

## üèóÔ∏è –î—ñ–∞–≥—Ä–∞–º–∞ –≤–∑–∞—î–º–æ–¥—ñ–π
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      HTTP / MQTT       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        –ü–ö (LLM)         ‚îÇ ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ ‚îÇ   Orange Pi Zero (API)   ‚îÇ
‚îÇ - FastAPI + Ollama      ‚îÇ                        ‚îÇ - FastAPI + MQTT client  ‚îÇ
‚îÇ - –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–µ–æ OpenCV  ‚îÇ                        ‚îÇ - GPIO/Serial –¥–æ Arduino ‚îÇ
‚îÇ - RAG –∑–Ω–∞–Ω–Ω—è            ‚îÇ                        ‚îÇ - –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–∞–¥–∞—á     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ Serial (JSON)                                      ‚îÇ
            ‚ñº                                                    ‚ñº
                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                         ‚îÇ Arduino Mega + PCA9685       ‚îÇ
                         ‚îÇ - 6 —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—ñ–≤ —Ä–æ–±–æ—Ä—É–∫–∏   ‚îÇ
                         ‚îÇ - –ê–Ω–∞–ª–æ–≥–æ–≤—ñ –¥–∞—Ç—á–∏–∫–∏          ‚îÇ
                         ‚îÇ - –†–µ–ª–µ (—Å–≤—ñ—Ç–ª–æ/–≤–µ–Ω—Ç/–ø–æ–º–ø–∞)   ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÇ –¶—ñ–ª—å–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- `pc-llm-service/`: Dockerized FastAPI —Å–µ—Ä–≤—ñ—Å –∑ Ollama, RAG, MQTT –∫–ª—ñ—î–Ω—Ç–æ–º, –æ–±—Ä–æ–±–∫–æ—é –≤—ñ–¥–µ–æ, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é —á–µ—Ä–µ–∑ YAML/ENV.
- `app/`: –æ–Ω–æ–≤–ª–µ–Ω–∏–π —Å–µ—Ä–≤—ñ—Å Orange Pi Zero –∑ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º —Ä–µ–ª–µ, –¥–∞—Ç—á–∏–∫–∞–º–∏ (BME280, VL53L0X, IR), –≤–∑–∞—î–º–æ–¥—ñ—î—é –∑ Arduino —Ç–∞ –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫–æ–º.
- `firmware/robotarm/`: —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π —Å–∫–µ—Ç—á Arduino —ñ–∑ JSON-–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º, watchdog, emergency stop, –∫–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è–º —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—ñ–≤.
- `docker-compose.pc.yml` —Ç–∞ `docker-compose.orangepi.yml`: –æ–∫—Ä–µ–º—ñ –∫–æ–º–ø–æ—É–∑-—Ñ–∞–π–ª–∏ –¥–ª—è –ü–ö —Ç–∞ Orange Pi, healthchecks —ñ —Å–ø—ñ–ª—å–Ω—ñ volume –¥–ª—è –æ–±–º—ñ–Ω—É.
- `monitoring/`: Prometheus + Grafana + –∫–∞—Å—Ç–æ–º–Ω–∏–π –µ–∫—Å–ø–æ—Ä—Ç–µ—Ä –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º–∏.
- `tests/`: pytest (unit + integration), –º–æ–∫ GPIO/–¥–∞—Ç—á–∏–∫—ñ–≤, end-to-end –∑–≤ º—è–∑–æ–∫ –ü–ö ‚Üî Orange Pi ‚Üî Arduino.

## ‚úÖ –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—é –≤–µ—Ä—Å—ñ—î—é
1. **–í–∏–¥–∞–ª–µ–Ω–æ Orange Pi PC**: YOLO –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –Ω–∞ –ü–ö, –¥–µ—Ç–µ–∫—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ä–∞–∑–æ–º –∑ LLM/–≤—ñ–¥–µ–æ–æ–±—Ä–æ–±–∫–æ—é.
2. **LLM –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä**: FastAPI + Ollama (qwen2.5 –∞–±–æ llama3.2), –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ RAG –¥–ª—è –∞–≥—Ä–æ–Ω–æ–º—ñ—á–Ω–∏—Ö –∑–Ω–∞–Ω—å.
3. **–†–æ–∑—à–∏—Ä–µ–Ω–∏–π Orange Pi Zero**: HTTP –∫–ª—ñ—î–Ω—Ç –¥–æ –ü–ö, GPIO/—Ä–µ–ª–µ, –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –ø–æ–ª–∏–≤—É —Ç–∞ –∞–≤–∞—Ä—ñ–π–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –∫–µ—à—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥.
4. **Arduino firmware**: –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –∞–Ω–∞–ª–æ–≥–æ–≤–∏—Ö –¥–∞—Ç—á–∏–∫—ñ–≤, —Ä–µ–ª–µ, —Ä–æ–∑—à–∏—Ä–µ–Ω–∏–π JSON –ø—Ä–æ—Ç–æ–∫–æ–ª, watchdog —Ç–∞ emergency stop.
5. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: Prometheus, Grafana dashboard, –∞–ª–µ—Ä—Ç–∏ –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ñ/–≤–æ–ª–æ–≥–æ—Å—Ç—ñ/–ø–æ–º–∏–ª–∫–∞—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.
6. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏**: —Å—Ü–µ–Ω–∞—Ä—ñ—ó –¥–ª—è –∑–≤ º—è–∑–∫—É –º—ñ–∂ —É—Å—ñ–º–∞ –≤—É–∑–ª–∞–º–∏, MQTT —Ç–∞ –∫–æ–º–∞–Ω–¥ —Ä–æ–±–æ—Ä—É–∫–∏.

## üîå –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è (–ø—Ä–∏–∫–ª–∞–¥)
`pc-llm-service/.env`:
```
OLLAMA_MODEL=qwen2.5:7b
OLLAMA_BASE_URL=http://localhost:11434
OPI_ZERO_HOST=192.168.1.101
OPI_ZERO_PORT=8000
MQTT_HOST=localhost
MQTT_PORT=1883
VECTOR_DB_PATH=./data/vector_db
KNOWLEDGE_PATH=./knowledge/
```

`app/.env` (Orange Pi Zero):
```
PC_HOST=192.168.1.100
PC_PORT=8080
SERIAL_DEV=/dev/ttyACM0
SERIAL_BAUDRATE=115200
MQTT_HOST=192.168.1.100
MQTT_PORT=1883
CAMERA_DEVICE=/dev/video0
RELAY_LIGHT_PIN=7
RELAY_FAN_PIN=8
RELAY_PUMP_PIN=10
BME280_ADDRESS=0x76
VL53L0X_ADDRESS=0x29
```

## üõ†Ô∏è –î–æ—Ä–æ–∂–Ω—è –∫–∞—Ä—Ç–∞ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è
1. **–°–µ—Ä–≤—ñ—Å LLM –Ω–∞ –ü–ö**: FastAPI + Ollama + RAG, MQTT –∫–ª—ñ—î–Ω—Ç, REST endpoints `/analyze_image`, `/make_decision`, `/system_status`.
2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è Orange Pi Zero**: –Ω–æ–≤—ñ endpoints –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏, HTTP –∫–ª—ñ—î–Ω—Ç –¥–æ –ü–ö, –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –ø–æ–ª–∏–≤—É, –≤–∏–¥–∞–ª–µ–Ω–Ω—è YOLO, —É–º–æ–≤–Ω–∏–π –∑–∞–ø—É—Å–∫ RL.
3. **Docker Compose**: –æ–∫—Ä–µ–º—ñ —Ñ–∞–π–ª–∏ –¥–ª—è –ü–ö —Ç–∞ Orange Pi, —Å–ø—ñ–ª—å–Ω–∏–π –±—Ä–æ–∫–µ—Ä MQTT, healthchecks, volumes.
4. **Makefile**: –∫–æ–º–∞–Ω–¥–∏ `pc-build/up/logs/shell`, `opi-build/up/logs/shell`, `health-all`, `monitor-mqtt`, `test-connection`, –¥–µ–ø–ª–æ–π —Ü—ñ–ª—ñ.
5. **RAG —Ç–∞ knowledge base**: Chroma/FAISS store, sentence-transformers embeddings, –¥–∞–Ω—ñ –ø—Ä–æ –¥–æ–≥–ª—è–¥, –ø–æ–ª–∏–≤, —Ö–≤–æ—Ä–æ–±–∏.
6. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: Prometheus + Grafana + custom exporter –¥–ª—è –¥–∞—Ç—á–∏–∫—ñ–≤/–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤/—Ä–æ–±–æ—Ä—É–∫–∏/LLM —Ä—ñ—à–µ–Ω—å.
7. **Arduino firmware**: JSON –ø—Ä–æ—Ç–æ–∫–æ–ª, —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∏, —Ä–µ–ª–µ, –∞–Ω–∞–ª–æ–≥–æ–≤—ñ –¥–∞—Ç—á–∏–∫–∏, emergency stop.
8. **–¢–µ—Å—Ç–∏**: pytest + pytest-asyncio, –º–æ–∫ GPIO/–¥–∞—Ç—á–∏–∫—ñ–≤, docker-compose –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤.

## üì¶ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü–ö –∫–µ—Ä—É—î –≤—Å—ñ—î—é —Å–∏—Å—Ç–µ–º–æ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é LLM —Ç–∞ –≤—ñ–¥–µ–æ–∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.
- Orange Pi Zero –≤–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥–∏, –º–∞—î –±–∞–∑–æ–≤—É –∞–≤—Ç–æ–Ω–æ–º—ñ—é —Ç–∞ –±–µ–∑–ø–µ—á–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∞–ø–∞—Ä–∞—Ç—É—Ä–æ—é.
- Arduino –∑–∞–±–µ–∑–ø–µ—á—É—î —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—ñ–≤ —Ç–∞ –¥–∞—Ç—á–∏–∫—ñ–≤ –∑ –∞–≤–∞—Ä—ñ–π–Ω–∏–º–∏ –º–µ—Ö–∞–Ω—ñ–∑–º–∞–º–∏.
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ —Ç–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó.
