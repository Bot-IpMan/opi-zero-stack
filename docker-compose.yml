services:
  mqtt:
    image: eclipse-mosquitto:2
    ports:
      - "1883:1883"
      - "9001:9001"  # WebSocket для dashboard
    volumes:
      - ./mosquitto/config:/mosquitto/config
    restart: unless-stopped

  app:
    build: ./app
    container_name: robot-app
    mem_limit: "150m"
    memswap_limit: "300m"
    pids_limit: 128
    cpus: "1"
    devices:
      - /dev/video0:/dev/video0
      - /dev/ttyACM0:/dev/ttyACM0
    group_add:
      - video
      - dialout
    environment:
      - MQTT_BROKER=mqtt
      - LLM_URL=http://192.168.1.152:8080
      - CAMERA_DEVICE=/dev/video0
      - SERIAL_PORT=/dev/ttyACM0
      - DUMMY_MODEL=0
    ports:
      - "8000:8000"
    depends_on:
      - mqtt
    restart: unless-stopped
