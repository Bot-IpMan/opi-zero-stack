#!/bin/bash
set -e

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ” Ğ”Ğ†ĞĞ“ĞĞĞ¡Ğ¢Ğ˜ĞšĞ ORANGE PI ZERO"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# 1. Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ° Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ
echo "ğŸ“‹ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
cat /etc/os-release | grep -E "PRETTY_NAME|VERSION" | head -2
echo ""

# 2. ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑĞ¾Ñ€Ğ°
echo "ğŸ–¥ï¸  ĞĞ Ğ¥Ğ†Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
uname -m
uname -a
echo ""

# 3. ĞŸÑ€Ğ¾Ñ†ĞµÑĞ¾Ñ€
echo "âš™ï¸  ĞŸĞ ĞĞ¦Ğ•Ğ¡ĞĞ :"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
cat /proc/cpuinfo | grep -E "processor|model name|BogoMIPS" | head -5
echo ""

# 4. ĞĞ¿ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ° Ğ¿Ğ°Ğ¼'ÑÑ‚ÑŒ
echo "ğŸ’¾ ĞŸĞĞœ'Ğ¯Ğ¢Ğ¬:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
free -h
echo ""

# 5. Ğ”Ğ¸ÑĞºĞ¾Ğ²Ğ° Ğ¿Ñ€Ğ¾ÑÑ‚Ñ–Ñ€
echo "ğŸ’¿ Ğ”Ğ˜Ğ¡Ğš:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
df -h / | tail -1
echo ""

# 6. Python Ğ²ĞµÑ€ÑÑ–Ñ
echo "ğŸ PYTHON:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
python3 --version
python3 -c "import struct; print(f'Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€ pointer: {struct.calcsize(\"P\")*8} Ğ±Ñ–Ñ‚')"
python3 -c "import sys; print(f'sys.platform: {sys.platform}')"
echo ""

# 7. Docker Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ
echo "ğŸ³ DOCKER:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
docker --version || echo "Docker Ğ½Ğµ Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹"
docker buildx version 2>/dev/null | head -1 || echo "Buildx Ğ½Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°"
echo ""

# 8. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ piwheels
echo "ğŸŒ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸ Ğ”Ğ PIWHEELS:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
curl -s -I https://www.piwheels.org/simple/numpy/ | head -3 || echo "âš ï¸  ĞĞµĞ¼Ğ°Ñ” Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ Ğ´Ğ¾ piwheels"
echo ""

# 9. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ğ½Ğ°ÑĞ²Ğ½Ğ¸Ñ… wheels Ğ½Ğ° piwheels Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ñ— Python Ğ²ĞµÑ€ÑÑ–Ñ—
echo "ğŸ“¦ WHEELS ĞĞ PIWHEELS Ğ”Ğ›Ğ¯ ĞŸĞĞ¢ĞĞ§ĞĞĞ‡ PYTHON Ğ’Ğ•Ğ Ğ¡Ğ†Ğ‡:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
PYTHON_VER=$(python3 --version | awk '{print $2}' | cut -d'.' -f1,2)
echo "Python Ğ²ĞµÑ€ÑÑ–Ñ: $PYTHON_VER"
echo ""
echo "OpenCV wheels:"
curl -s https://www.piwheels.org/api/v1/packages/opencv-python-headless/ | grep -o "\"cp3[0-9]\"" | sort -u | tr -d '"' || echo "âš ï¸  ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ"
echo ""

# 10. Test: ÑĞ¿Ñ€Ğ¾Ğ±Ğ° Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¸Ğ¹ Ğ¿Ğ°ĞºĞµÑ‚
echo "ğŸ§ª Ğ¢Ğ•Ğ¡Ğ¢: Ğ¡Ğ¿Ñ€Ğ¾Ğ±Ğ° Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ numpy Ğ· piwheels (Ğ±ĞµĞ·--only-binary):"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
pip index versions numpy --index-url https://www.piwheels.org/simple 2>&1 | head -10 || echo "âš ï¸  ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸"
echo ""

# 11. ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ pip
echo "ğŸ¯ ĞĞ Ğ¥Ğ†Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ Ğ”Ğ›Ğ¯ PIP:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
python3 -c "import distutils.util; print(distutils.util.get_platform())"
python3 -c "import wheel.cli; print(wheel.cli.parser.parse_args(['version']).command)"
python3 << 'EOF'
import sys
import pip
print(f"pip Ğ²ĞµÑ€ÑÑ–Ñ: {pip.__version__}")
print(f"Python wheels Ñ‚ĞµĞ³: {sys.implementation.name}-{sys.version_info.major}{sys.version_info.minor}")
EOF
echo ""

# 12. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° --only-binary Ğ¿Ğ¾Ğ²ĞµĞ´Ñ–Ğ½ĞºĞ¸
echo "ğŸ”§ ĞŸĞĞ’Ğ•Ğ”Ğ†ĞĞšĞ PIP Ğ— --only-binary:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
pip install --dry-run --only-binary=:all: numpy --index-url https://www.piwheels.org/simple 2>&1 | grep -E "Successfully|ERROR|Downloading" | head -5 || echo "âš ï¸  ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğ¸"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… Ğ”Ğ†ĞĞ“ĞĞĞ¡Ğ¢Ğ˜ĞšĞ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
